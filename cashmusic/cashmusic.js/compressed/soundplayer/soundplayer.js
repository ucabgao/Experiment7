// cashmusic.js v1 | (c) 2013 CASH Music | http://cashmusic.github.io/cashmusic.js/ | https://github.com/cashmusic/cashmusic.js/blob/master/LICENSE
(function(){var f=window.cashmusic;f.measure.getClickPosition=function(a){var b=a.currentTarget?a.currentTarget:a.srcElement,c=f.measure.getPosition(b),d=a.clientX-c.x;return{x:d,y:a.clientY-c.y,percentage:d/b.clientWidth}};f.measure.getPosition=function(a){for(var b=0,c=0;a;)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop,a=a.offsetParent;return{x:b,y:c}};Array.prototype.indexOf||(Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;
return-1});f.soundplayer={playlist:!1,playlists:{},sound:!1,lastTimeEvent:"0:00",styleDivs:null,tweenDivs:null,_init:function(){var a=f.soundplayer;a.styleDivs=document.querySelectorAll("*.cashmusic.setstyles");a.tweenDivs=document.querySelectorAll("*.cashmusic.tween");var b=document.querySelectorAll("div.cashmusic.soundplayer.playlist"),c=b.length;if(0<c)for(var d=0;d<c;d++){var e=b[d],g=f.getJSON(e.getAttribute("data-playlist")),g=a._formatPlaylist(g,e.id,d);e.id=e.id?e.id:g.id;for(var k=document.querySelectorAll("#"+
e.id+' a[href$=".mp3"],#'+e.id+' a[href$=".MP3"],#'+e.id+' a[href$=".ogg"],#'+e.id+' a[href$=".OGG"],#'+e.id+' a[href$=".m4a"],#'+e.id+' a[href$=".M4A"],#'+e.id+' a[href$=".wav"],#'+e.id+' a[href$=".WAV"]'),n=k.length,h=0;h<n;h++){var p=k[h];g.tracks.push(a._formatTrack(p,g.id));p.parentNode.removeChild(p)}k="<ol>";n=g.tracks.length;for(h=0;h<n;h++)g._index.push(g.tracks[h].id),soundManager.createSound({id:g.tracks[h].id,url:g.tracks[h].url}),k+='<li class="cashmusic soundplayer changetrack" data-track="'+
(h+1)+'">'+g.tracks[h].title+"</li>";k+="</ol>";a.playlists[g.id]=g;(function(b,c,d){f.getTemplate("soundplayer",function(e){e=e.replace(/data-playerid=\"/g,'data-playerid="'+c.id);e=e.replace(/onPlayer\":\"/g,'onPlayer":"'+c.id);b.innerHTML=e;b.style.visibility="visible";b.style.display="block";b.style.position="relative";e=document.querySelectorAll("#"+b.id+" div.cashmusic.soundplayer.playlist.tracklist");"undefined"!==e[0]&&(e[0].innerHTML=d);var g=document.querySelectorAll("#"+b.id+" div.cashmusic.soundplayer.playlist.nowplaying, #"+
b.id+" div.cashmusic.soundplayer.playlist.playtime, #"+b.id+" div.cashmusic.soundplayer.playlist.toggletracklist");e=g.length;for(var h=0;h<e;h++)g[h].innerHTML=g[h].getAttribute("data-content")+"";g=document.querySelectorAll("#"+b.id+" div.cashmusic.soundplayer.playlist.controls *, #"+b.id+" div.cashmusic.soundplayer.playlist.toggletracklist, #"+b.id+" li.cashmusic.soundplayer.changetrack");e=g.length;for(h=0;h<e;h++){var k=g[h];f.styles.hasClass(k,"playpause")&&(f.styles.addClass(k,"paused"),f.events.add(k,
"click",function(b){a.togglePlaylist(c.id)}));f.styles.hasClass(k,"nexttrack")&&f.events.add(k,"click",function(b){a.next(c.id,!0)});f.styles.hasClass(k,"prevtrack")&&f.events.add(k,"click",function(b){a.previous(c.id)});f.styles.hasClass(k,"toggletracklist")&&f.events.add(k,"click",function(a){a=document.querySelectorAll("#"+b.id+" div.cashmusic.soundplayer.playlist.tracklist")[0].style;"undefined"!==a&&(a.height="auto"!==a.height?"auto":"1px");k.blur()});f.styles.hasClass(k,"changetrack")&&f.events.add(k,
"click",function(b){b=(b.currentTarget?b.currentTarget:b.srcElement).getAttribute("data-track");a.playlistPlayTrack(c.id,b)})}g=document.querySelectorAll("#"+b.id+" div.cashmusic.soundplayer.playlist.seekbar");e=g.length;for(h=0;h<e;h++)f.events.add(g[h],"click",function(b){a.seek(f.measure.getClickPosition(b).percentage,c.id)})})})(e,g,k)}var b=document.querySelectorAll("*.cashmusic.soundplayer.playstop,a.cashmusic.soundplayer.inline"),c=b.length;if(0<c)for(f.styles.injectCSS('a.cashmusic.soundplayer.inline.stopped:after{content: " [\u25b8]";}a.cashmusic.soundplayer.inline.playing:after{content: " [\u25aa]";}'),
d=0;d<c;d++){var m=b[d];f.styles.addClass(m,"stopped");f.styles.hasClass(m,"playstop")||soundManager.createSound({id:m.href,url:m.href});f.events.add(m,"click",function(b){var c=f.styles.hasClass(m,"playstop")?soundManager.getSoundById(m.getAttribute("data-soundid")):soundManager.getSoundById(m.href);if(c)return a.toggle(c.id,!0),b.returnValue=!1,b.preventDefault&&b.preventDefault(),!1})}b=document.querySelectorAll("*.cashmusic.soundplayer.playpause");c=b.length;if(0<c)for(d=0;d<c;d++)e=b[d],f.styles.addClass(e,
"paused"),e.getAttribute("data-soundid"),e.getAttribute("data-playerid")?f.events.add(e,"click",function(b){a.togglePlaylist((b.currentTarget?b.currentTarget:b.srcElement).getAttribute("data-playerid"));b.returnValue=!1;b.preventDefault&&b.preventDefault();return!1}):f.events.add(e,"click",function(b){a.toggle((b.currentTarget?b.currentTarget:b.srcElement).getAttribute("data-soundid"));b.returnValue=!1;b.preventDefault&&b.preventDefault();return!1})}};window.SM2_DEFER=!0;f.loadScript(f.path+"lib/soundmanager/soundmanager2.js",
function(){var a=f.soundplayer;window.soundManager=new SoundManager;soundManager.setup({debugMode:!1,debugFlash:!1,preferFlash:!1,allowScriptAccess:"always",url:f.path+"lib/soundmanager/swf/",flashVersion:8,flashLoadTimeout:7500,flashPollingInterval:30,html5PollingInterval:30,useHighPerformance:!0,onready:function(){a._init()},defaultOptions:{onload:function(){a._doLoad({id:this.id})},onstop:function(){a._doStop({id:this.id})},onfinish:function(){a._doFinish({id:this.id})},onpause:function(){a._doPause({id:this.id})},
onplay:function(){a._doPlay({id:this.id})},onresume:function(){a._doResume({id:this.id})},stream:!0,usePolicyFile:!1,volume:100,whileloading:function(){a._doLoading({id:this.id,loaded:this.bytesLoaded,total:this.bytesTotal,percentage:Math.round(this.bytesLoaded/this.bytesTotal*1E3)/10})},whileplaying:function(){var b=Math.round(this.position/this.duration*1E4)/100;a._doPlaying({id:this.id,position:this.position,duration:this.duration,percentage:b})}}});soundManager.beginDelayedInit();a._doFinish=
function(b){a._updateStyles(a.styleDivs,"finish");a.next();window.cashmusic.events.fire(window.cashmusic,"soundplayerFinish",{soundId:a.sound.id})};a._doLoad=function(b){a._updateStyles(a.styleDivs,"load");window.cashmusic.events.fire(window.cashmusic,"soundplayerLoad",{soundId:a.sound.id})};a._doLoading=function(b){a._updateTweens(a.tweenDivs,"load",b.percentage,b.duration);window.cashmusic.events.fire(window.cashmusic,"soundplayerLoading",{soundId:a.sound.id,percentage:b.percentage,duration:b.duration})};
a._doPause=function(b){a._switchStylesForCollection(document.querySelectorAll("*.cashmusic.playpause"),"playing","paused");a._updateStyles(a.styleDivs,"pause");window.cashmusic.events.fire(window.cashmusic,"soundplayerPause",{soundId:a.sound.id})};a._doPlay=function(b){a._doResume(b);window.cashmusic.events.fire(window.cashmusic,"soundplayerPlay",{soundId:a.sound.id})};a._doPlaying=function(b){a._updateTweens(a.tweenDivs,"play",b.percentage,b.duration);a._updateTimes(b.position);var c=a._getTimecode(b.position);
c!=a.lastTimeEvent&&(a.lastTimeEvent=c,a._updateStyles(a.styleDivs,c));window.cashmusic.events.fire(window.cashmusic,"soundplayerPlaying",{soundId:a.sound.id,percentage:b.percentage,position:b.position,duration:b.duration,timecode:c})};a._doResume=function(b){a.styleDivs=document.querySelectorAll("*.cashmusic.setstyles");a.tweenDivs=document.querySelectorAll("*.cashmusic.tween");b=document.querySelectorAll('a.cashmusic.soundplayer.inline[href="'+a.sound.id+'"]');for(var c=b.length,d=0;d<c;d++)f.styles.swapClasses(b[d],
"stopped","playing");a._switchStylesForCollection(document.querySelectorAll("*.cashmusic.playpause"),"paused","playing");0<a.sound.position?a._updateStyles(a.styleDivs,"play"):a._updateStyles(a.styleDivs,"resume");window.cashmusic.events.fire(window.cashmusic,"soundplayerResume",{soundId:a.sound.id})};a._doStop=function(b){b=document.querySelectorAll('a.cashmusic.soundplayer.inline[href="'+b+'"]');for(var c=b.length,d=0;d<c;d++)f.styles.swapClasses(b[d],"playing","stopped");a._updateStyles(a.styleDivs,
"stop");window.cashmusic.events.fire(window.cashmusic,"soundplayerStop",{soundId:a.sound.id})};a.pause=function(){a.sound&&a.sound.pause()};a.play=function(){a.sound&&a.sound.play()};a.resume=function(){a.sound&&a.sound.paused&&a.sound.resume()};a.seek=function(b,c){if(c){if(!a.playlist||c!==a.playlist.id)return!1;a.sound.setPosition(Math.floor(b*a.sound.duration))}};a.stop=function(){a.sound&&(a.pause(),a.sound.setPosition(0),a._doStop(a.sound.id))};a.toggle=function(b,c){var d=c?a.stop:a.pause;
a.sound=a.sound?a.sound:soundManager.getSoundById(b);a.sound.id!==b&&(d(),a.sound=soundManager.getSoundById(b));c&&!a.sound.paused&&0!=a.sound.playState?a.stop():a.sound.togglePause();a._updateTitle()};a.next=function(b,c){a.loadPlaylist(b);var d=!1,e=!1,g=a.playlist;g&&(g.current<g.tracks.length?(d=parseInt(g.current)+1,e=!0):(d=1,c&&(e=!0)),g.current=d);e&&a.playlistPlayTrack(g.id,d)};a.previous=function(b){a.loadPlaylist(b);b=!1;var c=a.playlist;c&&(b=1<c.current?parseInt(c.current)-1:c.tracks.length,
c.current=b,a.playlistPlayTrack(c.id,b))};a.togglePlaylist=function(b){a.loadPlaylist(b);a.toggle(a.playlist.tracks[a.playlist.current-1].id)};a.playlistPlayTrack=function(b,c){a.loadPlaylist(b);a.stop();a.playlist.current=c;a.toggle(a.playlist.tracks[c-1].id)};a.loadPlaylist=function(b){a.sound&&a.playlist&&a.playlist.id!=b&&a.pause();a.sound&&!a.playlist&&a.stop();a.playlist=a.playlists[b]};a._checkIds=function(b,c){var d="",e="";"undefined"!==typeof c.onSound&&(d=c.onSound);"undefined"!==typeof c.onPlayer&&
(e=c.onPlayer);return d&&-1===b.indexOf(d)||e&&!a._inPlaylist(e,b)?!1:!0};a._getMS=function(a){a=a.split(":");var c=0,d=a.length;a.reverse();for(var e=0;e<d;e++)c+=parseInt(a[e])*(0==e?1:60*(1<e?60:1))*1E3;return c};a._getTimecode=function(a){var c=Math.floor(a/1E3);a=Math.floor(c/3600);var d=0<a?("00"+Math.floor((c-3600*a)/60)).substr(-2):Math.floor(c/60),c=("00"+(c-3600*a-60*d)).substr(-2);return 0<a?a+":"+d+":"+c:d+":"+c};a._checkIdsForElement=function(b,c){var d={};d.onSound=c.getAttribute("data-soundid");
d.onPlayer=c.getAttribute("data-playerid");return a._checkIds(b,d)};a._updateTweens=function(b,c,d,e){for(var g=b.length,k=0;k<g;k++){var n=b[k],h=n.getAttribute("data-tween");if((h=f.getJSON(h))&&"undefined"!==typeof h[c])for(var p=h[c].length,m=!1,l=!1,q=0;q<p;q++)l=h[c][q],a._checkIds(a.sound.id,l)&&(-1!==(l.startAt+"").indexOf(":")&&(l.startAt=Math.round(a._getMS(l.startAt)/e*1E4)/100),-1!==(l.endAt+"").indexOf(":")&&(l.endAt=Math.round(a._getMS(l.endAt)/e*1E4)/100),d>=l.startAt&&d<=l.endAt&&
(m=l.startVal+(l.endVal-l.startVal)/(l.endAt-l.startAt)*(d-l.startAt),m="px"==l.units?Math.floor(m):m.toFixed(2),n.style[l.name]=m+l.units))}};a._updateStyles=function(b,c){for(var d=b.length,e=0;e<d;e++){var g=b[e],f=g.getAttribute("data-styles");if((f=JSON.parse(f))&&"undefined"!==typeof f[c])for(var n=f[c].length,h=0;h<n;h++)a._checkIds(a.sound.id,f[c][h])&&("undefined"===typeof f[c][h].delay?g.style[f[c][h].name]=f[c][h].val:function(a,b,c,d){setTimeout(function(){a.style[b]=c},d)}(g,f[c][h].name,
f[c][h].val,f[c][h].delay))}};a._switchStylesForCollection=function(b,c,d){for(var e=b.length,g=0;g<e;g++)a._checkIdsForElement(a.sound.id,b[g])&&!f.styles.hasClass(a.sound.id,b[g],"inline")&&f.styles.swapClasses(b[g],c,d)};a._updateTimes=function(b){for(var c=document.querySelectorAll("div.cashmusic.soundplayer.playtime"),d=c.length,e=0;e<d;e++)a._checkIdsForElement(a.sound.id,c[e])&&(c[e].innerHTML=a._getTimecode(b))};a._updateTitle=function(){for(var b=document.querySelectorAll("div.cashmusic.soundplayer.nowplaying"),
c=b.length,d=0;d<c;d++)a._checkIdsForElement(a.sound.id,b[d])&&(b[d].innerHTML=a.playlist.tracks[a.playlist.current-1].title)};a._formatPlaylist=function(a,c,d){a=a?a:{};a.id||(a.id=c?c:"pl---"+d);a.current=1;a.tracks=a.tracks?a.tracks:[];a._index=[];return a};a._formatTrack=function(a,c){var d=f.getJSON(a.getAttribute("data-track")),d=d?d:{};d.url=d.url?d.url:a.href;d.title=d.title?d.title:a.innerText||a.textContent;d.id=c+d.url;return d};a._inPlaylist=function(b,c){return b?-1<a.playlists[b]._index.indexOf(c)?
!0:!1:!1}})})();